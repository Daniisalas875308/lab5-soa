# Lab 5 Integration and SOA - Project Report

## 1. EIP Diagram (Before)

![Before Diagram](/EIPBefore.png)


---

## 2. Analysis of Issues:

**What was wrong in the starter code?**

In the starter code, I found the following issues:
1. The message routing logic was not functioning as intended, leading to messages being sent to incorrect channels.
    The gateway sent messages directly to evenChannel, bypassing the flow.
2. The filter in oddFlow used `p % 2 == 0`, meaning only even numbers passed. This caused odd numbers to be filtered out incorrectly and be rejected.
3. The type of the channel in evenChannel and oddChannel were contrary, the oddChannel had to be pub/sub,  
so that both the service and the handle would receive the messages


**Why did those issues prevent correct behavior?**

With the starter code, the logs sequence was totally different that the expected one. The gateway message went always to the
evenChannel although the number was odd. Besides that, the odd numbers generated by the atomic incrementer were rejected by the filter, and  the handler and the service
never received the same message because the channel type was wrong.

**What patterns were misapplied?**

1. Messaging Gateway
2. Message Filter
3. Channel Types (Direct vs Pub/Sub)
4. Message Router
---

## 3. Implementation Changes:

**What code did you modify?**
To fix the issues, I made the following changes:
1. Added numberChannel (direct channel) and corrected Gateway to send to this new channel rather evenChannel. For this, I had to add a new bean
`numberFlow`. In this way, all outputs from both inputs are directed to the same channel.
2. Fixed filter condition to `p % 2 != 0` in oddFlow.
3. Changed oddChannel to a pub/sub channel.

**Why did you make each change?**
I made these changes to ensure that:
1. With the first modify, I get that Gateway acts as central input before routing and follows the same pattern as the atomic incrementer.
2. The second modification ensures that odd numbers pass correctly through the filter, and any other number will be rejected.
3. At least, with the last modify I get that both the service and the handler can receive odd messages from it.

**How do changes align with EIP patterns?**
1. The addition of numberChannel and the new flow aligns with the Messaging Gateway pattern, ensuring a single entry point for messages.
2. The correction of the filter condition aligns with the Message Filter pattern, ensuring that only the intended messages pass through.
3. Changing oddChannel to a pub/sub channel aligns with the Channel Types pattern, allowing multiple subscribers to receive messages from the same channel.
---

## 4. Learning Outcomes:

**What did you learn about EIP?**
- Each step in the pipeline must follow a clear responsibility: transform, route, filter, or handle.
- Message channels are essential to decouple flows and maintain controlled routing behavior.

**How does Spring Integration implement these patterns?** 
- Channels define asynchronous routing points.
- Integration flows allow chaining of filters, transformers, and routers declaratively.
- Gateways expose messaging as a simple method interface.

**What would you do differently next time?**
- I think that the steps that I took were correct, besides the difficult part was done in class with the teacher's help.

## 5. AI Disclosure:

For this exercise I did not use any AI assistance; I simply used Copilot for some corrections when preparing this report.
